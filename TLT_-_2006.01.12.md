---
title: TLT_-_2006.01.12
createdAt: 2006-01-11T14:01-05:00
editedAt: 2006-01-11T19:06-05:00
---

<blockquote><i>A brief description of my journey (so far) through continuation-land in Perl. I talk about wanting continuations, faking them, using real ones, desparing at their non-first-class nature, and finally how I am coming out of my depression to create work-arounds.</i></blockquote>

Outline:

* I love continuations

I love [[Continuation-based Web Programming]].

For the un-initiated let me give you the quick of it. A standard (CGI-style) web application is restarted for ever single request that the user makes. Users of the app don't realize this, all they see is page 1 followed by page 2 and so on. But behind the scenes, each click the user makes that goes to the application must contain not only the click, but enough context so that the app knows that this user is on step 3. The application must use tricks to manage its own high-level state between user interactions.

This is a bad thing. Or at least annoying. At the end of each state of the application it must explicitly decide what its next state will be.

Continuations change all that. While I won't go into the technical details (yet), using continuations switches things around from the programmer's point of view.

* Continuations in Perl

I wanted this for Perl. But Perl doesn't have continuations. The closes we have is cpan:Coro, which I was initially reluctant to use. Mostly because I wanted serializeable continuations... but I won't go into that here.

** Fake Continuations

I created [[Contize]], a fake-continuation engine for perl objects. Serializeable (and thus first-class) continuations! Very inneficiant, and several side-effects.

** Real Continuations

Finally I began working in earnest on a continuation server using cpan:Coro, which I call [http://continuity.tlt42.org|Continuity].

* I love first-class continuations

First-class continuations allow us to copy an existing continuations, and all of the state that it contains. So, for example, we could create a copy at every point in the navigation of our web-app. Then the back button and browser forking is magically fixed! We just restore one of these saved continuations.

* The downfall of first-class continuations in perl

cpan:Coro does not provide real, first-class, continuations. It has a module, cpan:Coro::Cont, which gives "continuations", but these are really just a simplified interface into coroutines. Namely, I can't create a copy of a running continuation, no matter how I try. Has to do with duplicating the C stack.

I got quite depressed.

* Coming out of the depression

Scott tried to cheer me up. He encouraged me to get on with my life -- to work with what I've got and to get some other things done. There is still alot to do on the whole toolkit. Perl6 will have continuations, and maybe they will be first-class. So we just need to be patient.

** Managing the back button

Still, in order to create advanced yet useable applications I need to somehow manage the back button and browser forking. The answer has come in the way of javascript and that whole AJAX craze. See, I can use javascript to detect that I am viewing a cached page, and then do a background request to the server to let it know what is going on. The server can give back some stuff and I can use DHTML to display the result.

** Managing forked browsers

I think I can do similar tricks for forked windows.

