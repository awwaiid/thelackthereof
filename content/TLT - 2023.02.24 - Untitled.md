---
draft: true
title: Human Essentials - Schema Exploration
tags: ["blog"]
createdAt: 2023-02-24
updatedAt: 2023-02-24
---

Trying to solidify the schema organization for [Human Essentials](https://humanessentials.app).

## Schema Exploration

I ran `rails erd filetype=dot attributes=false` and got a beast of a diagram. Then I went through and started adding each node to some subgraphs. After some combinations I came up with several logical groupings.

![ERD Overview](/content/human-essentials-erd-overview.png)

Groupings:
* Participants
* Intake
* Inventory
* Disbursal

Next I went through and kept deleting more things and added a splash of color. I also started to terminate edges at cluster boundaries.

```plantuml
digraph Diaper {

  rankdir = "LR";
  compound = true;
  fontsize = "13";
  fontname = "Arial Bold";
  node[ shape  =  "rectangle" , style="rounded,filled", fillcolor="white", fontsize  =  "10" , fontname  =  "Arial" , margin  =  "0.07,0.05" , penwidth  =  "1.0"];
  edge[ fontname  =  "Arial" , fontsize  =  "7" , dir  =  "both" , arrowsize  =  "0.9" , penwidth  =  "1.0" , labelangle  =  "32" , labeldistance  =  "1.8"];
  rankdir = "TB";
  label = "Diaper domain model\n\n";

  subgraph cluster_catalog {
    label="Catalog"
    bgcolor="lightblue"
    BaseItem
    Item
    ItemCategory
    Kit
    BarcodeItem
  }

  subgraph cluster_inventory {
    label="Inventory"
    bgcolor="lightyellow"
    StorageLocation
    Transfer
    InventoryItem
    Adjustment
    Audit
  }

  subgraph cluster_participants {
    label="Participants"
    bgcolor="orange"
    Organization
    AnnualReport
    User
    Role
    UsersRole
    Partner
    PartnerGroup
    "Partners::Profile"
    NDBNMember
    AccountRequest
    "Partners::Family"
    "Partners::Child"
    "Partners::AuthorizedFamilyMember"
  }

  subgraph cluster_acquisition {
    label="Acquisition"
    bgcolor="purple"
    DonationSite
    Donation
    ProductDriveParticipant
    Purchase
    Vendor
    ProductDrive
    Manufacturer
  }

  subgraph cluster_disbursal {
    label="Disbursal"
    bgcolor="red"
    Distribution
    Request
    "Partners::ItemRequest"
    "Partners::ChildItemRequest"
  }

  // Catalog
  BaseItem -> BarcodeItem [arrowhead = "normal", arrowtail = "none", weight = "1"];
  BaseItem -> Item [arrowhead = "normal", arrowtail = "none", weight = "2"];
  Item -> BarcodeItem [arrowhead = "normal", arrowtail = "none", weight = "1"];
  ItemCategory -> Item [arrowhead = "normal", arrowtail = "none", weight = "2"];
  ItemCategory -> PartnerGroup [arrowhead = "normal", arrowtail = "normal", weight = "2", lhead="cluster_participants", ltail="cluster_catalog"];
  Kit -> Item [arrowhead = "normal", arrowtail = "none", weight = "1", lhead="cluster_inventory"];

  // Participants
  "Partners::AuthorizedFamilyMember" -> "Partners::ChildItemRequest" [arrowhead = "normal", arrowtail = "none", weight = "2", lhead="cluster_disbursal"];
  "Partners::Child" -> "Partners::ChildItemRequest" [arrowhead = "normal", arrowtail = "none", weight = "2", lhead="cluster_disbursal"];
  "Partners::Family" -> "Partners::AuthorizedFamilyMember" [arrowhead = "normal", arrowtail = "none", weight = "2"];
  "Partners::Family" -> "Partners::Child" [arrowhead = "normal", arrowtail = "none", weight = "2"];
  AccountRequest -> Organization [arrowhead = "none", arrowtail = "none", weight = "2"];
  Manufacturer -> Donation [arrowhead = "normal", arrowtail = "none", weight = "2"];
  Organization -> Adjustment [arrowhead = "normal", arrowtail = "none", weight = "2", lhead="cluster_inventory"];
  Organization -> AnnualReport [arrowhead = "normal", arrowtail = "none", weight = "2"];
  Organization -> BarcodeItem [arrowhead = "normal", arrowtail = "none", weight = "2", lhead="cluster_catalog"];
  Organization -> Distribution [arrowhead = "normal", arrowtail = "none", weight = "2", lhead="cluster_disbursal"];
  Organization -> DonationSite [arrowhead = "normal", arrowtail = "none", weight = "2", lhead="cluster_acquisition"];
  Organization -> Partner [arrowhead = "normal", arrowtail = "none", weight = "2"];
  Organization -> PartnerGroup [arrowhead = "normal", arrowtail = "none", weight = "2"];
  Organization -> Role [arrowhead = "normal", arrowtail = "none", weight = "1"];
  Partner -> "Partners::Family" [arrowhead = "normal", arrowtail = "none", weight = "2"];
  Partner -> "Partners::Profile" [arrowhead = "none", arrowtail = "none", weight = "2"];
  Partner -> Distribution [arrowhead = "normal", arrowtail = "none", weight = "2", lhead="cluster_disbursal"];
  Partner -> Role [arrowhead = "normal", arrowtail = "none", weight = "1"];
  PartnerGroup -> Partner [arrowhead = "normal", arrowtail = "none", weight = "2"];
  Role -> User [arrowhead = "normal", arrowtail = "normal", weight = "4"];
  Role -> UsersRole [arrowhead = "normal", arrowtail = "none", weight = "1"];
  User -> Adjustment [arrowhead = "normal", arrowtail = "none", weight = "1", lhead="cluster_inventory"];
  User -> Request [arrowhead = "normal", arrowtail = "none", weight = "3", lhead="cluster_disbursal"];
  User -> UsersRole [arrowhead = "none", arrowtail = "none", weight = "3"];
  NDBNMember -> AccountRequest [arrowhead = "normal", arrowtail = "none", weight = "1"];
  NDBNMember -> Organization [arrowhead = "normal", arrowtail = "none", weight = "1"];

  // Inventory
  Adjustment -> Audit [arrowhead = "normal", arrowtail = "none", weight = "1"];
  Adjustment -> Item [arrowhead = "normal", arrowtail = "none", weight = "1", lhead="cluster_catalog"];
  Audit -> Item [arrowhead = "normal", arrowtail = "none", weight = "1", lhead="cluster_catalog"];
  StorageLocation -> Adjustment [arrowhead = "normal", arrowtail = "none", weight = "1"];
  StorageLocation -> Audit [arrowhead = "normal", arrowtail = "none", weight = "1"];
  StorageLocation -> Distribution [arrowhead = "normal", arrowtail = "none", weight = "2", lhead="cluster_disbursal"];
  StorageLocation -> Donation [arrowhead = "normal", arrowtail = "none", weight = "2", lhead="cluster_acquisition"];
  StorageLocation -> InventoryItem [arrowhead = "normal", arrowtail = "none", weight = "2"];
  StorageLocation -> Transfer [arrowhead = "normal", arrowtail = "none", weight = "4"];
  Transfer -> Item [arrowhead = "normal", arrowtail = "none", weight = "1", lhead="cluster_catalog"];

  // Disbursal
  Distribution -> Item [arrowhead = "normal", arrowtail = "none", weight = "1", lhead="cluster_catalog"];
  Distribution -> Request [arrowhead = "none", arrowtail = "none", weight = "2"];
  "Partners::ItemRequest" -> "Partners::ChildItemRequest" [arrowhead = "normal", arrowtail = "none", weight = "2"];
  Request -> "Partners::ItemRequest" [arrowhead = "normal", arrowtail = "none", weight = "2"];

  // Acquisition
  Donation -> Item [arrowhead = "normal", arrowtail = "none", weight = "1", lhead="cluster_catalog"];
  DonationSite -> Donation [arrowhead = "normal", arrowtail = "none", weight = "2"];
  ProductDrive -> Donation [arrowhead = "normal", arrowtail = "none", weight = "2"];
  ProductDriveParticipant -> Donation [arrowhead = "normal", arrowtail = "none", weight = "2"];
  Purchase -> Item [arrowhead = "normal", arrowtail = "none", weight = "1", lhead="cluster_catalog"];
  Vendor -> Purchase [arrowhead = "normal", arrowtail = "none", weight = "2"];
}
```

## Flow Exploration

Using this as inspiration, I've now started to group out the lifecycle of things.

```plantuml
skinparam componentStyle rectangle
skinparam linetype ortho

[Purchase] --> [Intake]
[Donation] --> [Intake]

rectangle "Bank" {
  [Inventory] --> [Adjustment]
  [Inventory] --> [Transfer]
}

rectangle "Partner" {
  [Distribution]
}

[Intake] -> [Inventory]
[Inventory] -> [Distribution]
[Distribution] --> [Recipient]
```

```plantuml
participant Donor
participant Supplier
Donor -> Bank: Donation
Supplier -> Bank: Purchase
Bank -> Bank: Inventory Management
Partner --> Bank: Request (Optional)
Bank -> Partner: Distribution
Partner -> "Client/Family": Dispense
```
